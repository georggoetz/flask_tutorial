{% extends 'base.jinja2' %}

{% block header %}
{% endblock %}

{% block content %}
{% for post in posts %}
<article class="post">
  <header class="post__header">
    <h1 class="post__title">{{ post.title }}</h1>
    <div class="post__meta">
      <span class="post__author">by {{ post.author.username }}</span>
      <span class="post__date">
        <svg class="post__date-icon" width="1.1em" height="1.1em" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" style="vertical-align: middle; margin-right: 0.2em;"><rect x="3" y="5" width="14" height="12" rx="2" fill="#bbb"/><rect x="7" y="9" width="6" height="2" rx="1" fill="#fff"/><rect x="3" y="3" width="14" height="2" rx="1" fill="#377ba8"/></svg>
        {{ post.created.strftime('%Y-%m-%d') }}
      </span>
    </div>
    {% if g.user.id == post['author_id'] %}
    <a class="nav__header-action" href="{{ url_for('blog.update', id=post.id) }}">Edit</a>
    {% endif %}
  </header>
  <section>
    <x-likes liked="{{ 'true' if g.user and g.user.likes_post(post) else 'false' }}" 
             count="{{ post.like_count }}" 
             url="{{ url_for('blog_api.like', id=post.id) }}"
             disabled="{{ 'true' if not g.user else 'false' }}">
    </x-likes>  
  </section>
</article>
{% endfor %}

{% set has_prev = page > 1 %}
{% set has_next = page < total_pages %}
<div class="pagination">
  {% if has_prev %}
    <a href="{{ url_for('blog.page', page=page-1) if page > 2 else url_for('blog.index') }}">« Previous</a>
  {% endif %}
  <span>Page {{ page }} of {{ total_pages }}</span>
  {% if has_next %}
    <a href="{{ url_for('blog.page', page=page+1) }}">Next »</a>
  {% endif %}
</div>
{% if g.user %}
<a class="fab" href="{{ url_for('blog.create') }}" title="Neuer Post">
  <svg class="fab__icon" width="1.6em" height="1.6em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
    <rect x="11" y="7" width="2" height="10" rx="1" fill="currentColor"/>
    <rect x="7" y="11" width="10" height="2" rx="1" fill="currentColor"/>
  </svg>
</a>
{% endif %}
{% endblock %}